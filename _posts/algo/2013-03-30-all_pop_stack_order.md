---
layout: post
title: "生成所有的出栈序列"
description: ""
category: algorithm
tags: [algo, data structure]
---
{% include JB/setup %}

本文包括以下3个部分
--------------
1.  生成所有的出栈序列.
2.  证明生成的出栈序列, 是正确的.
3.  证明生成了所有的出栈序列.

生成所有的出栈序列
------------------
基本的思路，用递归+回溯的方法模拟入栈和出栈过程。

1.  如果栈为空，就只能入栈.
2.  如果所有的数都已入栈，只能出栈, 并打印保存出栈序列.
3.  否则，就是栈不空，且有数据可继续如栈， 如此我们变面临连个选择，入或者出.
    入栈, 递归进入下一步;出栈，保存出栈序列，递归进入下一步.


这是按照1, n的顺序入栈模拟的出栈过程.  
{% highlight cpp%}
    int stack[N];
    int top = 0;
    void generate_all_pop_stack_order(int x, int *p, int pi)
    {
        if (top == 0 && x != N +1) {
            //只能进栈
            stack[top++] = x;
            generate_all_pop_stack_order(x + 1, p, pi);
            top--; //回溯
        } else if (x == N + 1) {

            print_and_check(p, pi);

        } else {

            int backup = stack[--top]; //for回溯
            //出栈
            p[pi] = backup;
            generate_all_pop_stack_order(x, p, pi + 1);
            stack[top++] = backup; //回溯

            //进栈
            stack[top++] = x;
            generate_all_pop_stack_order(x+1, p, pi);
            top--; //回溯
        }
    }
{% endhighlight %}
思路应该还是很清晰的.  
不过写起来还是要注意, 所做的修改，应该复原，否则会影响回溯的过程。


证明生成的序列是正确的
----------------------
也是用一个栈来模拟，并验证.  
我们知道,如果一个元素要出栈, 要出栈，就一定要先入栈.
就利用这个特点来验证即可.

如果栈为空或者栈顶元素不等于当前的出栈序列元素, 则只能如栈.  
如果所有的元素都已经入栈, 还是没有找到当前元素, 则不是一个有效的出栈序列.  

证明生成了所有的出栈序列
------------------------
怎么证明你生成了所有的出栈序列了呢？

得知道有多少出栈序列.

先给出结果:
$ {2n \choose n} - {2n \choose {n-1}} $

**证明**  

如果入栈用0表示, 出栈用1表示, 则入栈出栈过程可以写成01串. 
如果是一个有效的如栈出栈序列, 要保证1的累积个数不多余0的个数, 并且0和1的个数是相等的.  

n和0，和n个1 组成的串总共有${2n \choose n}$个，减去不合法的, 剩下的就是有效的出栈个数.

怎么求不合法的出栈序列个数呢,  

如果序列s是一个不合法的出栈序列, 那么必然在第2m + 1 上,首先出现1的个数多于0的个数. 
如果把[2m + 2, 2n]上的数字翻转, 那么1比0,多2个. 既有n+1个1 和 n-1个0.  

反过来, 如果一个序列有n+1个1和n-1个0, 那么必然存在2m+1使得首先出现的1的个数多于0个数, 
如果把[2m + 2, 2n]上的数字翻转, 刚好有n个0和n个1.  

如此编证明了，不合法的出栈序列和n+1个1和n-1个0组成的序列是一一对应的.
这样的序列有所少个呢, ${2n \choose {n-1}}$

so,对于n个数的一个入栈序列，出栈序列的个数是: $ {2n \choose n} - {2n \choose {n-1}} $


代码,也是包含这3个部分.
完成的测试代码在[这里][1].

参考资料:  
1. 组合数学(第4版), 卢开澄 <http://book.douban.com/subject/1229715/>

[1]: https://github.com/fly2best/pastebin/blob/master/algo/all_pop_stack_order.cc
